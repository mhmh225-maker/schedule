<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>24時間スケジュール入力 — 円グラフで表示</title>
  <style>
    :root{--bg:#f7f7fb;--card:#ffffff;--accent:#6b5b95;--muted:#666}
    html,body{height:100%;margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,'Hiragino Kaku Gothic ProN',Meiryo,sans-serif;background:var(--bg);color:#111}
    .wrap{max-width:980px;margin:28px auto;padding:18px}
    header{display:flex;align-items:center;gap:12px}
    h1{margin:0;font-size:20px}
    .grid{display:grid;grid-template-columns:1fr 420px;gap:18px;margin-top:18px}
    .card{background:var(--card);border-radius:12px;padding:14px;box-shadow:0 6px 18px rgba(20,20,40,0.06)}
    label{display:block;font-size:13px;color:var(--muted);margin-bottom:6px}
    .rows{max-height:380px;overflow:auto;margin-bottom:10px}
    .row{display:flex;gap:8px;align-items:center;margin-bottom:8px}
    .row input[type="text"]{flex:1;padding:8px;border-radius:8px;border:1px solid #e6e6ee}
    .row input[type="number"]{width:96px;padding:8px;border-radius:8px;border:1px solid #e6e6ee}
    .btn{background:var(--accent);color:#fff;padding:10px 12px;border-radius:10px;border:0;cursor:pointer}
    .btn.ghost{background:transparent;color:var(--accent);border:1px solid rgba(107,91,149,0.12)}
    .legend{display:flex;flex-wrap:wrap;gap:8px;margin-top:8px}
    .legend div{display:flex;gap:8px;align-items:center;font-size:13px}
    .colorbox{width:14px;height:14px;border-radius:4px}
    .summary{margin-top:12px;font-size:14px}
    footer{margin-top:18px;font-size:13px;color:var(--muted)}
    @media (max-width:920px){.grid{grid-template-columns:1fr;}}
  </style>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>24時間の理想スケジュール — 入力して円グラフ表示</h1>
    </header>

    <div class="grid">
      <section class="card">
        <label for="fs-endpoint">Formspree エンドポイント（固定）</label>
        <input id="fs-endpoint" type="text" value="https://formspree.io/f/mzzknnkz" style="width:100%;padding:8px;border-radius:8px;border:1px solid #e6e6ee">

        <hr style="margin:12px 0;border:none;border-top:1px solid #f0eef6">

        <label>項目を追加（活動名・時間）</label>
        <div class="rows" id="rows"></div>
        <div style="display:flex;gap:8px">
          <button id="addBtn" class="btn ghost">＋ 項目を追加</button>
          <button id="autoFill" class="btn ghost">サンプルで埋める</button>
          <button id="clearBtn" class="btn ghost">クリア</button>
        </div>

        <div class="summary">合計: <strong id="totalHours">0</strong> 時間</div>

        <div style="display:flex;gap:8px;margin-top:10px">
          <button id="drawBtn" class="btn">円グラフを描画</button>
          <button id="mailBtn" class="btn">メールで送信（Formspree）</button>
        </div>
      </section>

      <aside class="card">
        <canvas id="pieChart" width="400" height="400"></canvas>
        <div class="legend" id="legend"></div>
      </aside>
    </div>

    <footer>
      ・活動時間の合計を24時間にすると見やすいです。
    </footer>
  </div>

<script>
function randColor(i){
  const hues=[220,260,200,340,10,40,150,30,280,190];
  const h=hues[i%hues.length];
  return `hsl(${h} 60% 55%)`;
}
function formatHours(x){return Math.round(x*100)/100;}

const rowsEl=document.getElementById('rows');
const totalEl=document.getElementById('totalHours');

function createRow(name='',hours=''){
  const div=document.createElement('div');
  div.className='row';
  div.innerHTML=`
    <input type="text" placeholder="活動名" value="${name}">
    <input type="number" step="0.25" min="0" placeholder="時間" value="${hours}">
    <button class="btn ghost">×</button>`;
  div.querySelector('button').addEventListener('click',()=>{div.remove();recalc();});
  div.querySelectorAll('input').forEach(i=>i.addEventListener('input',recalc));
  rowsEl.appendChild(div);
}

function collectData(){
  return [...rowsEl.querySelectorAll('.row')].map((r,i)=>{
    const name=r.querySelector('input[type=text]').value.trim()||`項目${i+1}`;
    const hours=parseFloat(r.querySelector('input[type=number]').value)||0;
    return {name, hours};
  }).filter(x=>x.hours>0);
}

function recalc(){
  const data=collectData();
  totalEl.textContent=formatHours(data.reduce((a,b)=>a+b.hours,0));
}

createRow('睡眠',8);
createRow('授業/学習',8);
createRow('自由時間',8);
recalc();

document.getElementById('addBtn').onclick=()=>createRow();
document.getElementById('clearBtn').onclick=()=>{rowsEl.innerHTML='';recalc();};
document.getElementById('autoFill').onclick=()=>{
  rowsEl.innerHTML='';
  [['睡眠',8],['授業/学習',6],['仕事',4],['食事',2],['自由時間',3],['身支度',1]].forEach(r=>createRow(...r));
  recalc();
};

let chart=null;
document.getElementById('drawBtn').onclick=()=>{
  const raw=collectData();
  const ctx=document.getElementById('pieChart').getContext('2d');
  const labels=raw.map(r=>r.name);
  const values=raw.map(r=>r.hours);
  const colors=raw.map((_,i)=>randColor(i));
  if(chart)chart.destroy();
  chart=new Chart(ctx,{type:'pie',data:{labels,datasets:[{data:values,backgroundColor:colors}]} });
  renderLegend(labels,values,colors);
};

function renderLegend(labels,values,colors){
  const legend=document.getElementById('legend');
  legend.innerHTML='';
  labels.forEach((lab,i)=>{
    const d=document.createElement('div');
    d.innerHTML=`<span class="colorbox" style="background:${colors[i]}"></span>${lab} — ${values[i]}h`;
    legend.appendChild(d);
  });
}

function makeMailText(){
  const data=collectData();
  let text=`24時間スケジュール
-----------------------
`;
  data.forEach(i=>{text+=`${i.name}: ${i.hours}時間
`;});
  text+=`
合計: ${formatHours(data.reduce((a,b)=>a+b.hours,0))}時間`;
  return text;
}

document.getElementById('mailBtn').onclick=async()=>{
  const url=document.getElementById('fs-endpoint').value.trim();
  if(!url)return alert('Formspreeのエンドポイントを入力してください');

  const formData=new FormData();
  formData.append('message',makeMailText());

  try{
    const res=await fetch(url,{method:'POST',body:formData});
    if(res.ok)alert('メール送信成功！');
    else alert('送信失敗: '+res.status);
  }catch(e){alert('送信エラー:'+e);}
};
</script>
</body>
</html>
